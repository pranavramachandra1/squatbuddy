import pytest
from squat_buddy import SquatBuddy

class TestClass:

    def test_kp_equality(self):
        kp1 = [[[[0.32299444, 0.57279426, 0.62763846],
                                    [0.3102881 , 0.573672  , 0.34679925],
                                    [0.30702233, 0.56530744, 0.45643127],
                                    [0.31393778, 0.5510899 , 0.1721648 ],
                                    [0.3107613 , 0.51773393, 0.32446107],
                                    [0.4035098 , 0.5415994 , 0.5217142 ],
                                    [0.40954205, 0.44421107, 0.70641315],
                                    [0.5028379 , 0.649181  , 0.34475094],
                                    [0.50694597, 0.5272894 , 0.42794698],
                                    [0.43014225, 0.62728286, 0.4246127 ],
                                    [0.426812  , 0.6197923 , 0.38607913],
                                    [0.60512763, 0.4214359 , 0.5574268 ],
                                    [0.61085916, 0.33030516, 0.55498326],
                                    [0.64989185, 0.56050396, 0.5531847 ],
                                    [0.68618953, 0.42993993, 0.4908097 ],
                                    [0.8310332 , 0.51374394, 0.40468824],
                                    [0.89558136, 0.35748225, 0.7180898 ]]]]
        kp2 = [[[[0.32299444, 0.57279426, 0.62763846],
                                    [0.3102881 , 0.573672  , 0.34679925],
                                    [0.30702233, 0.56530744, 0.45643127],
                                    [0.31393778, 0.5510899 , 0.1721648 ],
                                    [0.3107613 , 0.51773393, 0.32446107],
                                    [0.4035098 , 0.5415994 , 0.5217142 ],
                                    [0.40954205, 0.44421107, 0.70641315],
                                    [0.5028379 , 0.649181  , 0.34475094],
                                    [0.50694597, 0.5272894 , 0.42794698],
                                    [0.43014225, 0.62728286, 0.4246127 ],
                                    [0.426812  , 0.6197923 , 0.38607913],
                                    [0.60512763, 0.4214359 , 0.5574268 ],
                                    [0.61085916, 0.33030516, 0.55498326],
                                    [0.64989185, 0.56050396, 0.5531847 ],
                                    [0.68618953, 0.42993993, 0.4908097 ],
                                    [0.8310332 , 0.51374394, 0.40468824],
                                    [0.89558136, 0.35748225, 0.7180898 ]]]]
        
        kp3 = [[[[0.32299444, 0.57279426, 0.62763846],
                                    [0.3102881 , 0.573672  , 0.34679925],
                                    [0.30702233, 0.56530744, 0.45643127],
                                    [0.31393778, 0.5510899 , 0.1721648 ],
                                    [0.3107613 , 0.51773393, 0.32446107],
                                    [0.4035098 , 0.5415994 , 0.5217142 ],
                                    [0.40954205, 0.44421107, 0.70641315],
                                    [0.5028379 , 0.649181  , 0.34475094],
                                    [0.50694597, 0.5272894 , 0.42794698],
                                    [0.43014225, 0.62728286, 0.4246127 ],
                                    [0.85324985  , 0.6197923 , 0.38607913],
                                    [0.60512763, 0.4214359 , 0.5574268 ],
                                    [0.61085916, 0.33030516, 0.55498326],
                                    [0.64989185, 0.56050396, 0.5531847 ],
                                    [0.68618953, 0.42993993, 0.4908097 ],
                                    [0.8310332 , 0.51374394, 0.40468824],
                                    [0.89558136, 0.35748225, 0.7180898 ]]]]
        
        sb = SquatBuddy()
        assert sb.is_same_keypoints(kp1, kp2), True
        assert sb.is_same_keypoints(kp1, kp3) == False

    def test_one_image(self):
        sb = SquatBuddy()
        keypoints_with_scores = sb.process_image("test_images/input_image.jpeg")
        expected_keypoints_with_scores = [[[[0.32299444, 0.57279426, 0.62763846],
                                    [0.3102881 , 0.573672  , 0.34679925],
                                    [0.30702233, 0.56530744, 0.45643127],
                                    [0.31393778, 0.5510899 , 0.1721648 ],
                                    [0.3107613 , 0.51773393, 0.32446107],
                                    [0.4035098 , 0.5415994 , 0.5217142 ],
                                    [0.40954205, 0.44421107, 0.70641315],
                                    [0.5028379 , 0.649181  , 0.34475094],
                                    [0.50694597, 0.5272894 , 0.42794698],
                                    [0.43014225, 0.62728286, 0.4246127 ],
                                    [0.426812  , 0.6197923 , 0.38607913],
                                    [0.60512763, 0.4214359 , 0.5574268 ],
                                    [0.61085916, 0.33030516, 0.55498326],
                                    [0.64989185, 0.56050396, 0.5531847 ],
                                    [0.68618953, 0.42993993, 0.4908097 ],
                                    [0.8310332 , 0.51374394, 0.40468824],
                                    [0.89558136, 0.35748225, 0.7180898 ]]]]

        assert sb.is_same_keypoints(keypoints_with_scores, expected_keypoints_with_scores)

    def test_video(self):

        sb = SquatBuddy()
        body_data = sb.process_video("test_images/IMG_2547.MOV")

        breakpoint()

        assert True
